  这一章的程序不需要自己写一遍以加深记忆，实际上，这种显示屏网上开源的很多，我们只要拿到一个相同型号的显示屏芯片的开源代码，学会移植并且能大致地看懂器代码含义就可以了。

  现在我讲一个移植的时候大家大概率会碰到的情况，FSMC模拟8080时序的时候ADDSET和DATAST如何确定的问题。

  首先，通过对比我们可以发现，8080时序和FSMC的B模式非常相似，见下图：
  ![image](https://github.com/user-attachments/assets/4923ef0c-2094-4439-a0d8-3c3f570f5fb9)
  ![image](https://github.com/user-attachments/assets/5198a5e6-6173-44ef-a607-3a84a1c67d95)
  ![image](https://github.com/user-attachments/assets/4378708f-2275-4be5-9a7c-478dfabfcc88)


  A[25:0](地址线，在这里只需要任选一条地址线作为D/CX线即可)对应D/CX线(数据/命令选择线，低电平表示命令，高电平表示数据)
  
  NEx(片选信号)对应CSX(片选信号)
  
  NOE(读使能)对应RDX(读使能)
  
  NWE(写使能)对应WRX(写使能)
  
  D[15:0](数据线，这里都需要接上)对应D[17:0](数据线)，可以发现这是并行传输
  
  模式B的NADV的变化不用担心，直接不让他连着ILI9431的引脚就完事，这样就不会影响到8080时序。让它自个玩去吧
  
  现在我们需要配置ADDSET和DATAST这俩个值，根据我上一节说的，我们要找类似于t_SU(data)和t_SU(addr),但由于这里是模拟，所以找不到t_SU(data)和t_SU(addr)这样的字眼
  
  这时候我们就要对时序了，让我们看8080和FSMC的NOE和RDX;NWE和WRX。
  
  先看NOE和RDX，我们发现在FSMC模式B中，NOE是低电平，所以那应该是低电平有效;我们看8080时序，RDX也有一段低电平的时候，我们根据表中的时序，得到根据严格的时序要求的话，t_SU(addr)=trdlfm=355ns,计算出来ADDSET应该为25
  
  同理，再看NWE和WRX,我们发现在FSMC模式B中，NWE是低电平然后突然拉高电平延后一个HCLK周期，所以那应该是低电平加上一段高电平有效;我们看8080时序，WRX低电平对应的时间是t_SU(data)=twc=66ns,计算得出DATAST应该为4
  
  这样配置一定是没问题的，但是你的直觉告诉你，这个ADDSET是不是有问题，怎么能这么大一个？
  
  你的直觉是对的，确实太大了，实际上，读时序只需要65ns即可，这个有可能是芯片厂商的问题。毕竟前后延时 大约会有30ns的误差，但也不可能这么大。
  
  所以，如果实在不会看，或者遇到这种纯纯恶心人的怎么办？怕啥，直接枚举法试一试呗！反正它有不会损坏硬件，试就完了
  
  接下来讲移植的第二个要点，我们是用A[25:0]中的其中一根地址线去模拟D/CX线，但是这个引脚我们调成了复用模式，决定权已经给了FSMC，A16的拉高和拉低已经不能用GPIO寄存器进行控制了，这时候我们就只能通过操作地址的方式进行"硬拉"
  
  首先，我们用的是BANK1-BORSRAM1，有效地址范围是0X6000 0000 到 0X63FF FFFF，然后理论上，我们只要使得第16位设为1即可，于是做如下运算：
  
  0X6000 0000 |= (1«16) = 0x6001 0000位高电平;0X6000 0000 &= ~ (1«16) = 0x6000 0000为低电平
  
  但是不出意外的出意外了，这样子是有问题的。查阅参考手册我们可以知道，STM32 内部访问地址时使用的是内部 HADDR 总线，它是需要转换到外部存储器的内部 AHB 地址线，它是字节地址 (8 位)，而存储器访问不都是按字节访问，因此接到存储器的地址线依存储器的数据宽度有所不同。见下图:
![image](https://github.com/user-attachments/assets/4daa696e-29c1-4daf-b580-873c2fdf96dd)

  我们配置FSMC时用的是16位的数据访问方式，所以HADDR[0]未接，也就是说，所以 HADDR 与 FSMC_A 的地址线连接关系会左移一位，所以应该做如下运算:
  
  0X6000 0000 |= (1«(16+1)) = 0x6002 0000为高电平;0X6000 0000 &= ~ (1«(16+1)) = 0x6000 0000为低电平

  如果引脚用的不同，那仅仅是位次不同而已，例如你用的是A15地址线，那就是15位左移1位(16)位置1即可。

  移植就这俩点需要注意，其余的就自由发挥了，我在main函数中有一个示范，大家若不是很熟可以参考参考

  当然，能不烧录就不烧录，因为画的太丑了......
