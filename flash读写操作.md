外部Flash的读写用到的是SPI协议。SPI协议和I2C有相同之处，我们只需要了解其差异，大致地我们就可以编写外部Flash的读写程序了

第一：SPI和I2C用到的引脚存在差异。

外部Flash主要用到了这四个引脚：NSS;MOSI;MISO;SCK。

NSS：片选信号线，拉低SPI对应的NSS总线，就相当于告诉SPI外设，轮到你工作了。

MOSI:写数据（MCU → Flash）

MISO:读数据（Flash → MCU）

SCK：时钟

而 WP 和 HOLD 通常接上拉电阻或直接拉高（禁用功能），不用 MCU 控制。

第二:SPI和I2C用到的命令有所差别。

在I2C中，我们的步骤是:发送地址->发送数据。这里面的地址其实就相当于命令。而在SPI中，指令比I2C更加丰富，基本步骤为:发送指令->发送地址->发送数据。

下面是SPI外设Flash的常见指令

![image](https://github.com/user-attachments/assets/df40320d-54b1-4869-b932-d129e0a108eb)

第三:EEPROM和Flash写方式的不同。

在EEPROM中，我们可以直接写入数据达到覆盖原有数据的目的。但是在Flash中，我们需要先擦除原有的数据，然后再进行写入，不然SPI的WEL位会强制置位为0，拒绝写入。

第四：SPI和I2C读取数据的不同

在I2C协议中，读取数据是有一个专门的时序，这个时序被封装成了I2C_ReceiveData()函数;但是在SPI中并没有专门的接收数据的函数，而是要通过发送伪数据让从设备返回其内部的数据。为什么呢?因为SPI是“全双工”通信：每发送一个字节（MOSI），就会同步接收一个字节（MISO）——无论你想不想接收。而I2C是"半双工"通信，通信双方不能同时“发”和“收”，一次只能是一个方向的数据流。

上述就是I2C和SPI的差异，现在我们具体了解SPI的结构体成员，对SPI外设--Flash进行读写操作

