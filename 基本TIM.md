  在stm32f1系列中，定时器分为三种定时器:基本定时器，通用定时器和高级定时器。见下图：
  ![image](https://github.com/user-attachments/assets/1c5643d5-3fa3-4818-8416-0fdbd9acff0a)

  在这张图中，你会看到一系列的新名词。例如"互补输出"，"捕获/比较通道"。若你提前瞟了一眼高级TIM，你还会发现"死区"，"H桥"等这些东西。若你现在直接取查AI问这些东西，你一定会看得头大!

  这里我就先不解释，我按照我的思路去理解基本TIM和后面的高级TIM。

  首先，先附上一张基本定时器功能框图
  ![image](https://github.com/user-attachments/assets/a68d4eb7-3266-4d62-abb9-a760ec61e801)

  好，看一眼就好，不用按照野火的手册去理解，那太不好懂了，听我的思路。

  1.在前面的程序配置一些外设时(如GPIO,ADC)，都要开启时钟吧，都需要一个时钟源吧。既然是个定时器，肯定也需要一个时钟源。时钟源就由系统时钟APB总线的时钟PCLK1提供。PCLK1到这里要经过一个预分频器。这里的分频和之前的相比略有不同，如果 APB1 预分频系数等于 1，则频率不变，否则频率乘以 2。例如库函数中 APB1 预分频的系数是 2，PCLK1=36M，所以定时器时钟=36*2=72M。

  2.定时器时钟的频率已经定下来了，那如果我想用这个频率怎么办？这时候定时器内部还有一个分频器(PSC)，它能对TIMxCLK 进行 1~65536 之间的任何一个数进行分频

  好，现在来解释一下专业名词。APB1总线时钟PLCK1先分频得到定时器时钟TIMxCLK(也称内部时钟CK_INT)。然后再经过定时器内部的分频器(PSC)在进行一次分频，得到CK_CNT。

  3.都叫定时器了是不是得有个东西来数时间啊，在定时器里面有一个计数器(CNT)，最大值是65535，对于基本定时器来说，只能往上计数。

  4.那数到哪时候才停？定时器里面有一个自动重装寄存器(ARR)，当计数到这个值的时候，如果使能了中断的话，定时器就产生溢出中断。

  所以定时器的基本原理我们就可以理通了，CNT用着PCLK经过APB分频和PSC分频后的频率(CK_CNT)去计数，当计数的值达到ARR里面的值后就可以产生中断。

  知道这个后，那么中断周期我们也可以知道了，那不就是计时器(CNT)计一个数的时间乘以它总计数(ARR)吗？因此公式为1/CK_CNT*(ARR+1).因为计数器是从0开始数，所以是ARR+1；CK_CNT是频率，T=1/f。如果在中断服务程序里面设置一个变量 time，用来记录中断的次数，当到一段时间后再进行对执行一些程序。那么就可以计算出我们需要的定时时间等于：1/CK_CLK* (ARR+1)*time。

  
