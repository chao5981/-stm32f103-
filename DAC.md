  DAC 为数字/模拟转换模块，故名思议，它的作用就是把输入的数字编码，转换成对应的模拟电压输出，它的功能与 ADC 相反。在常见的数字信号系统中，大部分传感器信号被化成电压信号，而 ADC 把电压模拟信号转换成易于计算机存储、处理的
数字编码，由计算机处理完成后，再由DAC 输出电压模拟信号，该电压模拟信号常常用来驱动某些执行器件，使人类易于感知。如音频信号的采集及还原就是这样一个过程。

  DAC可以输出伪噪音信号，三角波信号(这俩个都是硬件自动生成)，或者正弦波和奇奇怪怪的信号(这些是需要软件控制其每一刻电压的大小)
  
  下面是DAC的功能框架图：
  <img width="1235" height="763" alt="image" src="https://github.com/user-attachments/assets/6221cef7-3059-407d-bc36-ff8978e47e32" />

  左下角为DAC的参考电源引脚，电压范围2.4-3.3V。
  
  左上角为其触发源，DAC根据外部中断(EXTI_9)或者定时器的CNT溢出触发DAC进行数据的跟换工作。
  
  如何更新数据呢，看右上角，要么就通过硬件配置的生成伪噪音信号/三角波信号，传过来一个触发源信号DAC就根据其配置的数值范围按照一定规律进行数据转换。如果选择的是正弦波或者奇奇怪怪的信号，那么就需要通过DMA从软件缓冲区搬运数据，
传过来一个触发源信号就要求DMA搬运一次数据

  最后，再看右下角，当DAC进行一次数据转换后，就把新的数据传到数字至模拟转换器中，这个转换器输出相应的电压，依次叠加，从而得到想要的波形。

  了解其工作原理后，我们介绍一下其结构体。

      1.DAC_Trigger：本成员用于配置 DAC 的触发模式，当 DAC 产生相应的触发事件时
      2.DAC_WaveGeneratio：本成员用于配置使用DAC输出伪噪声信号或三角波(即是否直接通过硬件输出伪噪声信号或三角波)
      3.DAC_LFSRUnmask_TriangleAmplitude：本成员和DAC_WaveGeneratio一起配套使用，用于设定生成的伪噪音信号或三角波的最大幅度的值
      4.DAC_OutputBuffer:本成员用于控制是否使能 DAC 的输出缓冲。启用输出缓冲器能提高驱动能力，禁用输出缓冲器适合高阻抗负载。

  要是留心的话，你打开看看DAC_LFSRUnmask_TriangleAmplitude结构体成员的值，会发现其最大值只有4095.

  这是为什么呢，这取决于其数据保持寄存器(DHR)和数据输出寄存器(DOR)。根据DAC工作原理，讲得更加细致一点的话，数据是先存储在DHR寄存器中，然后触发源一旦传来信号，那么DHR就把数据传给DOR，DOR根据数据的值输出对应的电压。
其关键原因是寄存器DHR和DOR的位数问题。这俩个寄存器有俩种，一种是一个通道只有8位，其余8位保留；一种是一个通道只有12位，其余4位保留。也就是说，即使你输入一个数据转化为2进制，8位以上/12位以上的值会被直接忽略(具体忽略多少位)
看你把数据存在那个寄存器中。所以，数据的峰值最大也只有4095(对应12位全是1).当然你要设置成8位也可以，但是没必要，没啥区别。

  <img width="792" height="729" alt="image" src="https://github.com/user-attachments/assets/d52ade01-c354-4f45-a9d9-a08f40c34a6f" />

  左对齐和右对齐没啥区别，就是一个从0到4095，一个从65520到65536，取值范围不同罢了。然后数据的传输前需要略作改变而已，这个后面再提。

  好，后面讲一下如何配置DAC

  这里以输出正弦波为例子。

  配置好DMA,DAC,GPIO,TIM这几个结构体，开启DMA通道请求，使能DMA通道，使能DMA等日常操作就不多赘述。

  主要是数据要如何做，这个取决于你把数据存储到哪个寄存器中，比如我存储在了双DAC的 12 位右对齐数据保持寄存器(DAC_DHR12RD)，那么我需要同时把DAC1和DAC2的数据都通过DMA放到这个DHR12RD寄存器中。我先定义DAC1和DAC2数据的俩个16类
型的数组，写入最大值不超过4095的值，然后定义一个u32类型的数组。让16位的数组的值左移16位并加上另外一个u16类型的值，就能实现同时把DAC1和DAC2的数据都存储进去。

  如果你选择的是单个DAC通道的12位右对齐数据保持寄存器，那么无需移位就不需要加了。为什么还需要移位呢，因为DMA传输数据是u32类型，防止数据在强转时发生意外的变动，在栈很富裕的情况下，还是提前转一下吧。

  这里再补充一下DAC输出频率的计算公式。

  DAC的周期就是定时器的触发周期乘以波单个周期的点数N。具体细节公式推导附上：

  <img width="954" height="555" alt="image" src="https://github.com/user-attachments/assets/1dfb24d2-3878-4cb7-8846-96dcf1a25573" />


  注意：指南者的PA5和SPI--Flash的CLK时钟线共用了，如果同时开启了Flash，那么就会干扰DAC波信号的输出。
