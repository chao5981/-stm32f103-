再stm32f103中，中断可以被分为俩种，一种是内部中断，一种是外部中断。

这一节我们只讲外部中断。

外部中断的实现需要俩个控制器共同实现，一个是NVIC(嵌套向量中断控制器);一个是EXTI(外部中断/事件控制器)。

这俩个是如何工作的呢，简单来说，NVIC是用来配置中断的优先级的，就像是51单片机中调用中断时的"interrupt x"中的"x";而EXTI是负责检测外部引脚的电平变化（如按键、GPIO 边沿触发），并生成中断请求信号给NVIC。

这里我们需要的是外设中断，关键是弄懂EXTI控制器是如何工作的，原理图如图所示。
![image](https://github.com/user-attachments/assets/2ca12bfc-abe3-4ee4-9ca7-9b3723444e02)
红色的是中断线，我先讲解中断线。

1.输入线连接上一个外设(例如按键等)，外设电平的变化会被输入线检测到并且传递给边沿检测电路

2.如图所示，边沿检测电路中连接着俩个寄存器上升沿触发选择寄存器 (EXTI_RTSR) 和下降沿触发选择寄存器 (EXTI_FTSR),你可以配置这个边沿检测电路选择其中一个寄存器或者俩个寄存器都选。只有来自输入线上的电平变化和你选的寄存器的电平变化一致时，才会输出有效信号。例如：你要求当按键的电平从0变化到1才能触发中断，当输入线传来的引脚信号是从1变成了0，和边沿检测电路的不一致，那么就发出无效信号，若传来的信号是从0到1，和边沿检测电路的信号一致，它才会向后面发出有效信号。

3.一个或门电路，连接着软件中断事件寄存器(EXTI_SWIER)，你可以配置使得中断的是否开启，就和C51中的中断开关类似

4.一个与门电路，连接着中断屏蔽寄存器(EXTI_IMR),和软件中断事件寄存器的作用类似，只是反了过来而已

5.将EXTI_PR寄存器内容输出到NVIC内，从而实现系统中断事件控制。

接下来我们来看事件线。

事件线的前三步和中断线一致，我们这里就不做赘述

4.也就是编号6：一个与门电路，连接着事件屏蔽寄存器(EXTI_EMR)，类似于中断屏蔽计时器。

5.也就是编号7：一个脉冲发生器，当传来有效信号1时，就会产生一个脉冲信号，这个脉冲信号可以给其他外设电路使用，比如定时器TIM、模拟数字转换器ADC等等。

至此，EXTI和NVIC的工作原理我们全部介绍完毕，下面我们开始利用中断编写一个程序--按下按键即为中断，在中断函数中使得LED灯的颜发生变化。

