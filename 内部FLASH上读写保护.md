  这一节内容的相关寄存器无法在stm32f10x中文参考手册中查询，需要上网搜索《STM32F10x闪存编程参考手册》自行查阅。

  在实际发布的产品中，在 STM32 芯片的内部 FLASH 存储了控制程序，如果不作任何保护措施的话，可以使用下载器直接把内部 FLASH 的内容读取回来，得到 bin 或 hex 文件格式的代码拷贝，别有用心的厂商会利用该方法山寨
产品。为此，STM32 芯片提供了多种方式保护内部 FLASH 的程序不被非法读取，但在默认情况下该保护功能是不开启的。若要开启该功能，需要改写内部FLASH 选项字节 (Option Bytes) 中的配置。

  写保护:写保护的配置一般以 4K 字节为单位,可以根据库函数选择哪些位置不允许写入。被设置成写保护后，主 FLASH 中的内容使用任何方式都不能被擦除和写入，写保护不会影响读访问权限。

  解除写保护:解除写保护后，主 FLASH 中的内容不会像解读保护那样丢失，它会被原样保留

  读保护:在这种情况下，若使用调试功能 (使用下载器、仿真器) 或者从内部 SRAM 自举时都不能对内部 FLASH 作任何访问 (读写、擦除都被禁止)；被设置成读保护后，FLASH 前 4K 字节的空间会强制加上写保护.利用这个特性，
可以编写 IAP 代码 (In Application Program) 更新 FLASH 中的程序，它的原理是通过某个通讯接口获取将要更新的程序内容，然后利用内部 FLASH 擦写操作把这些内容烧录到自己的内部 FLASH 中，实现应用程序的更新，该原
理类似串口 ISP 程序下载功能，只不过 ISP 这个接收数据并更新的代码由 ST 提供，且存放在系统存储区域，而 IAP 是由用户自行编写的，存放在用户自定义的 FLASH 区域，且通讯方式可根据用户自身的需求定制，如 IIC、SPI 
等，只要能接收到数据均可。

  解除读保护:芯片会自动触发擦除主 FLASH 存储器的全部内容，即解除保护后原内部 FLASH的代码会丢失，从而防止降级后原内容被读取到。


  下面介绍配置读保护和写保护的一般步骤:

  1.允许对flash寄存器进行操作
  2.擦除选项字节的内容
  3.
    a.设置读保护:调用写保护函数FLASH_EnableWriteProtection()，选择全部页或者部分页
    b.设置解除读保护:调用写保护函数FLASH_EnableWriteProtection()，参数选择为0(即不对任何页进行保护)
    c.设置读保护:调用读保护函数FLASH_ReadOutProtection()，选择ENABLE;
    d.设置解除读保护:调用读保护函数FLASH_ReadOutProtection()，选择DISABLE;

  4.对于写保护/解除写保护，需要复位芯片才能加载，而复位函数定义在core_cm3.h头文件中NVIC_SystemReset();而对于读保护，需要重新上电才可以，对于解除读保护而已，程序已经被删除了，一旦执行读保护解除，后面的程序
一律都不会执行。

  5.对于检测是否有进行读保护/写保护，如下:
    
  a.写保护:调用FLASH_GetWriteProtectionOptionByte()检测WRPR寄存器位，值如下:
    
  <img width="808" height="496" alt="image" src="https://github.com/user-attachments/assets/dbb850e7-88c9-4c53-9ffa-fd70aa35abb2" />

  b.读保护:调用FLASH_GetReadOutProtectionStatus()检测是否设置的读保护。(设置了为SET，未设置RESET)

  

    
  
