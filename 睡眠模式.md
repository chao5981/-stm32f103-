  如果我不想让stm3上电后一直工作，我想让他在不需要工作的时候适当地"停下来"省点电。要如何做呢？

  为了方便电源管理，内核电路(VDD供电区域和1.8V供电区域)的调压器提供了四种模式，功耗从高到低各自是:运行模式;睡眠模式;停止模式;待机模式。

  这里主要讲睡眠模式。

  先附上并讲解一下STM32的电源系统功能框架图

  <img width="876" height="613" alt="image" src="https://github.com/user-attachments/assets/fe037122-b673-493d-857a-3bad009f176b" />

  
  这里我们可以看到，ADC,DAC,复位模块和PLL时钟是单独供电的，为了方便进行单独的滤波。中间的就是上面提到的内核电路(VDD供电区域和1.8V供电区域)。

  在运行模式下，1.8V域全功率运行；在停止模式下 1.8V 域运行在低功耗状态，1.8V 区域的所有时钟都被关闭，相应的外设都停止了工作，但它会保留内核寄存器以及 SRAM 的内容；在待机模式下，整个 1.8V 域都断电，该区域的内核寄存器及 SRAM 
内容都会丢失 (备份区域的寄存器不受影响)。

  备份区域一般由3V 的钮扣电池对该引脚供电。可以看到的是其左侧有个开关，一个连接了 VBAT 电源，处一个连接了 VDD 主电源。右侧引出到备份域电路中。当 VDD 主电源存在时，由于 VDD 电压较高，备份域电路通过 VDD 供电，节省钮扣电池的
电源，仅当 VDD 掉电时，备份域电路由钮扣电池通过 VBAT 供电，保证电路能持续运行，从而可利用它保留关键数据。

  睡眠模式的特性如下：
  <img width="921" height="423" alt="image" src="https://github.com/user-attachments/assets/9fe6ce08-3ec8-441d-b526-ad2d33cedcea" />

  也就是说，只要你不要操作内核寄存器中的SLEEPDEEP位，保持原样，然后你只需要调用WFI或者WFE指令就可以进入睡眠模式。具体选择哪一个指令看你退出睡眠模式的操作决定。

  在睡眠模式中，外设不会彻底停止，仍然正常工作，只是不能执行新的程序，也不能烧录程序。

  其原理是睡眠模式只是关闭了内核时钟：停止（CPU 休眠）。而系统时钟(SYSCLK),外设时钟(PCLK)都是正常运行的，所有外设仍保持进入睡眠状态前的状态进行工作。

  如果调用WFI和WFE指令，这个在core_cm.h文件中封装好了，直接调用__WFI()/__WFE()即可。

  在调用__WFI()/__WFE()之前，记得开启PWR时钟。

  然后就没有特别的了，正常配置中断，然后在主函数中调用指令进入睡眠模式。一旦有中断，stm32会被唤醒。唤醒后接着执行__WFI()/__WFE()之后的指令。

  
