  在 STM32 芯片内部有一个 FLASH 存储器，它主要用于存储代码，我们在电脑上编写好应用程序后，使用下载器把编译后的代码文件烧录到该内部 FLASH 中，由于 FLASH 存储器的内容在掉电后不会丢失，芯片重新上电复位后，内
核可从内部 FLASH 中加载代码并运行。

  除了使用外部的工具（如下载器）读写内部 FLASH 外，STM32 芯片在运行的时候，也能对自身的内部 FLASH 进行读写，因此，若内部 FLASH 存储了应用程序后还有剩余的空间，我们可以把它像外部 SPI-FLASH 那样利用起来，
存储一些程序运行时产生的需要掉电保存的数据。由于访问内部 FLASH 的速度要比外部的 SPI-FLASH 快得多，所以在紧急状态下常常会使用内部FLASH 存储关键记录；为了防止应用程序被抄袭，有的应用会禁止读写内部 FLASH 中的
内容，或者在第一次运行时计算加密信息并记录到某些区域，然后删除自身的部分加密代码，这些应用都涉及到内部 FLASH 的操作。

  首先，要读写内部FLASH，我们要知道内部FLASH的容量是多少，这个我们可以通过芯片的型号得知

  <img width="916" height="774" alt="image" src="https://github.com/user-attachments/assets/4cba3ca8-8b47-4bf0-bc2a-2af44fdaf996" />

  得知指南者的内部FLASH是512KB，属于大容量FLASH，大容量FLASH内部构成如下：

  <img width="880" height="329" alt="image" src="https://github.com/user-attachments/assets/3d908bf1-6c2e-4848-9bcb-f8c70c5135a7" />

  主存储：一般我们说 STM32 内部 FLASH 的时候，都是指这个主存储器区域，它是存储用户应用程序的空间，若使用超大容量、中容量或小容量产品，它们主存储器的页数量、页大小均有不同，使用的时候要注意区分

  系统存储区：系统存储区是用户不能访问的区域，它在芯片出厂时已经固化了启动代码，它负责实现串口、USB以及 CAN 等 ISP 烧录功能

  选项字节：选项字节用于配置 FLASH 的读写保护、待机/停机复位、软件/硬件看门狗等功能，这部分共 16字节。可以通过修改 FLASH 的选项控制寄存器修改

  下面讲解读写FLASH的一般操作

  写操作：

    1.允许对 FLASH 的寄存器进行写操作
    2.清除所有标志位
    3.擦除要写入的扇区(页数)
    4.写入数据

  其实操作和读写外部FLASH差不多，只是没有SPI协议无需等待，并且都封装好了具体的函数

  读操作:直接用指针的方式读取数据

  注意:写入内部FLASH的数据不能和存储在内部 FLASH编译后的代码文件重合，需要查看map文件查看FLASH哪些还没有被使用

  这里查看map文件，发现地址最大为0x08000968，其余都没有被用到

  <img width="1305" height="800" alt="image" src="https://github.com/user-attachments/assets/1e8b6890-2560-40e9-8199-c1aaae7d4a31" />
  




